<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="golang project architecture-202301071505 Summary 結構化的 Golang project 設計
Notes 這是個老議題了, 但最近在網路上看到滿多教學文在講 project setup
還是來分享一下自己目前的理解跟設計
專案架構 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  ."><title>golang project architecture-202301071505</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://jneo8.com//icon.png><link href=https://jneo8.com/styles.706bb6073ba85d26809f9096dae23a6b.min.css rel=stylesheet><link href=https://jneo8.com/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://jneo8.com/js/darkmode.f52bbb93a2caaffeee5a05995b383961.min.js></script>
<script src=https://jneo8.com/js/util.5e39932758f9ecaf45fd54506ed61416.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://jneo8.com/js/popover.6da9b273c092cc16fc1aa904d71a2163.min.js></script>
<script src=https://jneo8.com/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://jneo8.com/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://jneo8.com/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://jneo8.com/",fetchData=Promise.all([fetch("https://jneo8.com/indices/linkIndex.dd3479455364d06c3301c58184e866af.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://jneo8.com/indices/contentIndex.7d666b6d1b1356a13232cfd992407d9a.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://jneo8.com",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://jneo8.com",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/jneo8.com\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-171057898-1","auto"),ga("send","pageview"))</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://jneo8.com/js/full-text-search.51f0b1753e9b30839d053f8a98cc20d1.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://jneo8.com/>jneo8.com</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>golang project architecture-202301071505</h1><p class=meta>Last updated
Jan 7, 2023
<a href=https://github.com/jneo8/jneo8.github.io/tree/hugo/content/publish/golang%20project%20architecture-202301071505.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://jneo8.com/tags/articles/>Articles</a></li><li><a href=https://jneo8.com/tags/golang/>Golang</a></li><li><a href=https://jneo8.com/tags/project-structure/>Project structure</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#專案架構>專案架構</a></li><li><a href=#entity-layer>Entity Layer</a><ol><li><a href=#entity>/entity</a></li></ol></li><li><a href=#drivers>Drivers</a><ol><li><a href=#repository>/repository</a></li></ol></li><li><a href=#usecase-layer>Usecase Layer</a><ol><li><a href=#usecase>/usecase</a></li></ol></li><li><a href=#interface-adopters-layer>Interface Adopters Layer</a><ol><li><a href=#cmd>/cmd</a></li><li><a href=#api>/api</a></li></ol></li><li><a href=#support-packages>Support packages</a><ol><li><a href=#pkg>/pkg</a></li></ol></li><li><a href=#common-projects-directories>Common projects directories</a><ol><li><a href=#config>/config</a></li><li><a href=#docs>/docs</a></li><li><a href=#infra>/infra</a></li><li><a href=#assets>/assets</a></li><li><a href=#bin>/bin</a></li><li><a href=#scripts>/Scripts</a></li><li><a href=#deployments-or-deploy>/deployments or /deploy</a></li><li><a href=#build>/build</a></li><li><a href=#test>/test</a></li></ol></li></ol></nav></details></aside><a href=#golang-project-architecture-202301071505><h1 id=golang-project-architecture-202301071505><span class=hanchor arialabel=Anchor># </span>golang project architecture-202301071505</h1></a><a href=#summary><h1 id=summary><span class=hanchor arialabel=Anchor># </span>Summary</h1></a><p>結構化的 Golang project 設計</p><a href=#notes><h1 id=notes><span class=hanchor arialabel=Anchor># </span>Notes</h1></a><p>這是個老議題了, 但最近在網路上看到滿多教學文在講 project setup</p><p>還是來分享一下自己目前的理解跟設計</p><a href=#專案架構><h2 id=專案架構><span class=hanchor arialabel=Anchor># </span>專案架構</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── assets
</span></span><span class=line><span class=cl>├── bin
</span></span><span class=line><span class=cl>├── build
</span></span><span class=line><span class=cl>├── CHANGELOG.md
</span></span><span class=line><span class=cl>├── cmd
</span></span><span class=line><span class=cl>│   ├── demo1
</span></span><span class=line><span class=cl>│   │   └── main.go
</span></span><span class=line><span class=cl>│   └── demo2
</span></span><span class=line><span class=cl>│       └── main.go
</span></span><span class=line><span class=cl>├── configs
</span></span><span class=line><span class=cl>├── deployment
</span></span><span class=line><span class=cl>├── docs
</span></span><span class=line><span class=cl>├── entity
</span></span><span class=line><span class=cl>├── go.mod
</span></span><span class=line><span class=cl>├── go.sum
</span></span><span class=line><span class=cl>├── infra
</span></span><span class=line><span class=cl>├── Makefile
</span></span><span class=line><span class=cl>├── pkg
</span></span><span class=line><span class=cl>├── README.md
</span></span><span class=line><span class=cl>├── repository
</span></span><span class=line><span class=cl>├── scripts
</span></span><span class=line><span class=cl>└── usecase
</span></span></code></pre></td></tr></table></div></div><a href=#entity-layer><h2 id=entity-layer><span class=hanchor arialabel=Anchor># </span>Entity Layer</h2></a><a href=#entity><h3 id=entity><span class=hanchor arialabel=Anchor># </span>/entity</h3></a><ul><li><p>在說明 entity 放什麼之前, 先看一下 entity 的 解釋</p><blockquote><p><strong>Entities encapsulate Enterprise wide business rules. An entity can be an object with methods, or it can be a set of data structures and functions. It doesn’t matter so long as the entities could be used by many different applications in the enterprise. If you don’t have an enterprise, and are just writing a single application, then these entities are the business objects of the application. They encapsulate the most general and high-level rules. They are the least likely to change when something external changes. For example, you would not expect these objects to be affected by a change to page navigation, or security. No operational change to any particular application should affect the entity layer.</strong></p></blockquote></li><li><p>所以 entity 是什麼 ?</p><ul><li>是最高級的實體, 包含一些針對實體的 function</li><li>變動最小 (你不會希望你到處引用的 struct 一直被修改)</li><li>因為是最高層的, 不會引用別人, 會被各個 application 引用</li><li>entity 並不包含 database/service/application, 是最簡單的封裝</li></ul></li></ul><a href=#drivers><h2 id=drivers><span class=hanchor arialabel=Anchor># </span>Drivers</h2></a><a href=#repository><h3 id=repository><span class=hanchor arialabel=Anchor># </span>/repository</h3></a><ul><li><p>Repository Pattern</p></li><li><p>通常都是定義好對應的 interface 再用某個 Datebase 去實做, 好處是可以隔離 db & service. 例如 usecase 使用 repository, 對他來說就看不見下層的 Database.</p></li><li><p>個人覺得有個麻煩的地方就是雖然有辦法抽換 Database, 但如果初期沒有規劃好 interface 的話, 有可能會變成看似隔開了但其實沒有. 比較好的訣竅可能是在設計 Repository 時不應該針對特定 Database. 自己是覺得這方面自己做的不太好就是了.</p><ul><li>另外就是抽換真的很麻煩, 需要實做 interface, 評估效能..etc.</li></ul></li></ul><a href=#usecase-layer><h2 id=usecase-layer><span class=hanchor arialabel=Anchor># </span>Usecase Layer</h2></a><a href=#usecase><h3 id=usecase><span class=hanchor arialabel=Anchor># </span>/usecase</h3></a><ul><li>基本上業務邏輯會被集中在這層, 通常是放 Service</li><li>改動程度最大</li></ul><a href=#interface-adopters-layer><h2 id=interface-adopters-layer><span class=hanchor arialabel=Anchor># </span>Interface Adopters Layer</h2></a><a href=#cmd><h3 id=cmd><span class=hanchor arialabel=Anchor># </span>/cmd</h3></a><ul><li>Main application package</li><li>相較有些 project 會把 main.go 放在根目錄, 如果你的 application 需要多個 binary(只有一個也沒關係), 個人認為 cmd 是更好的選擇.</li><li>這邊通常不會有太多 business logic, 主要都只有CLI, 讀取設定, Dependency injection 和 service 啟動的簡單邏輯</li><li>編譯完的 binary 都會放到 /bin</li></ul><a href=#api><h3 id=api><span class=hanchor arialabel=Anchor># </span>/api</h3></a><ul><li>API Documents OpenAPI/Swagger</li><li>Router / Middleware / httputils</li><li>Examples<ul><li><a href=https://github.com/moby/moby/tree/master/api rel=noopener>https://github.com/moby/moby/tree/master/api</a></li></ul></li></ul><a href=#support-packages><h2 id=support-packages><span class=hanchor arialabel=Anchor># </span>Support packages</h2></a><a href=#pkg><h3 id=pkg><span class=hanchor arialabel=Anchor># </span>/pkg</h3></a><ul><li>logging/file handling/encryption, etc.</li><li>其它 package(api/usecase/cmd)可以引用</li><li>不是核心業務邏輯<ul><li>這部份私人認為判斷上有其難度, 如何切分業務邏輯, 這也是每個 Engineer 要下的決定</li></ul></li></ul><a href=#common-projects-directories><h2 id=common-projects-directories><span class=hanchor arialabel=Anchor># </span>Common projects directories</h2></a><a href=#config><h3 id=config><span class=hanchor arialabel=Anchor># </span>/config</h3></a><ul><li>設定用的 yaml</li></ul><a href=#docs><h3 id=docs><span class=hanchor arialabel=Anchor># </span>/docs</h3></a><ul><li>嗯, 就是文件</li></ul><a href=#infra><h3 id=infra><span class=hanchor arialabel=Anchor># </span>/infra</h3></a><ul><li>快速的 Infrastructure setup</li><li>有些教學會把 repository 放進來, 但個人認為一個完整的 project 可能會需要設定開發or測試時所需要的 infrastcture, 比如說某個Database, 這邊主要放這些 setup 的 tools/scripts.</li></ul><a href=#assets><h3 id=assets><span class=hanchor arialabel=Anchor># </span>/assets</h3></a><ul><li>靜態文件</li></ul><a href=#bin><h3 id=bin><span class=hanchor arialabel=Anchor># </span>/bin</h3></a><ul><li>放編譯完的執行檔</li></ul><a href=#scripts><h3 id=scripts><span class=hanchor arialabel=Anchor># </span>/Scripts</h3></a><ul><li>Shell script files</li><li>避免 Makefile 過於肥大, 太過複雜的 script 就放這</li></ul><a href=#deployments-or-deploy><h3 id=deployments-or-deploy><span class=hanchor arialabel=Anchor># </span>/deployments or /deploy</h3></a><ul><li>主要是部署文件</li><li>docker-compose</li><li>kubernetes/helm</li><li>mesos</li><li>terraform</li></ul><a href=#build><h3 id=build><span class=hanchor arialabel=Anchor># </span>/build</h3></a><ul><li>Build/CI scripts and config</li><li>CI config & scripts -> <code>build/ci</code><ul><li>有些 CI 會指定檔案位置, 如果可行的話儘量擺這</li></ul></li></ul><a href=#test><h3 id=test><span class=hanchor arialabel=Anchor># </span>/test</h3></a><ul><li>Cross-functional test suites</li></ul><a href=#recap><h1 id=recap><span class=hanchor arialabel=Anchor># </span>Recap</h1></a><p>這是大多數在工作上常用的配置, 好處是因為有依照 clean architecture 去切分 package, 大多數的改動只需要動到單一幾個package.
會讓 PM 產生一種你 code 寫很快的錯覺.
另外要廢言一下怎麼評估自己的 project 切分的好不好</p><ul><li>對新人的易上手程度<ul><li>設計上就是簡單易懂就好</li><li>文件 +　Script 的完整度</li><li>變相降低 switch 成本</li></ul></li><li>Business rule 切分<ul><li>這滿吃經驗的, 自己也是學習中</li></ul></li><li>Dependency Injection<ul><li>DI 做的好, 測試沒煩惱</li><li>抽象程度的拿捏也需要經驗跟練習</li></ul></li></ul><p>最後要說, 大多數時間 project 都不是完美的架構, 可能需要經過時間跟專案複雜度微調
就像一些實驗性的 project 可能就不會這樣完整
架構也是慢慢發展起來</p><hr><a href=#references><h1 id=references><span class=hanchor arialabel=Anchor># </span>References</h1></a><ul><li><a href=https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html rel=noopener>https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html</a></li><li><a href=https://eltonminetto.net/en/post/2020-07-06-clean-architecture-2years-later/ rel=noopener>https://eltonminetto.net/en/post/2020-07-06-clean-architecture-2years-later/</a></li><li><a href=https://github.com/golang-standards/project-layout rel=noopener>https://github.com/golang-standards/project-layout</a></li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://jneo8.com/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by jneo8 using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://jneo8.com/>Home</a></li><li><a href=https://twitter.com/lin_jneo8>Twitter</a></li><li><a href=https://github.com/jneo8>GitHub</a></li></ul></footer></div></div></body></html>